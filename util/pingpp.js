!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pingppPc=e()}}(function(){return function e(n,t,r){function a(l,o){if(!t[l]){if(!n[l]){var c="function"==typeof require&&require;if(!o&&c)return c(l,!0);if(i)return i(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var u=t[l]={exports:{}};n[l][0].call(u.exports,function(e){var t=n[l][1][e];return a(t||e)},u,u.exports,e,n,t,r)}return t[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)a(r[l]);return a}({1:[function(e,n,t){var r=e('./payment_elements.js');n.exports={userCallback:void 0,urlReturnCallback:void 0,urlReturnChannels:['alipay_pc_direct'],innerCallback:function(e,n){'function'==typeof this.userCallback&&(void 0===n&&(n=this.error()),this.userCallback(e,n),this.userCallback=void 0,r.clear())},error:function(e,n){return{msg:e=void 0===e?'':e,extra:n=void 0===n?'':n}},triggerUrlReturnCallback:function(e,n){'function'==typeof this.urlReturnCallback&&this.urlReturnCallback(e,n)},shouldReturnUrlByCallback:function(e){return'function'==typeof this.urlReturnCallback&&this.urlReturnChannels.includes(e)}}},{"./payment_elements.js":9}],2:[function(e,n,t){var r=e('../stash'),a=e('../callbacks'),i={}.hasOwnProperty;n.exports={handleCharge:function(e){for(var n=e.credential[e.channel],t=['appId','timeStamp','nonceStr','package','signType','paySign'],l=0;l<t.length;l++)if(!i.call(n,t[l]))return void a.innerCallback('fail',a.error('invalid_credential','missing_field_'+t[l]));r.jsApiParameters=n,this.callpay()},wxLiteEnabled:function(){return'undefined'!=typeof wx&&wx.requestPayment},callpay:function(){if(this.wxLiteEnabled()){var e=r.jsApiParameters;delete e.appId,e.complete=function(e){'requestPayment:ok'===e.errMsg&&a.innerCallback('success'),'requestPayment:cancel'===e.errMsg&&a.innerCallback('cancel',a.error('用户取消支付')),'undefined'!==e.err_code&&'undefined'!==e.err_desc&&a.innerCallback('fail',a.error(e.err_desc,e))},wx.requestPayment(e)}else console.log('请在微信小程序中打开')},runTestMode:function(e){wx.showModal({title:'提示',content:'因 "微信小程序" 限制 域名的原因 暂不支持 模拟付款 请使用 livekey 获取 charge 进行支付'})}}},{"../callbacks":1,"../stash":10}],3:[function(e,n,t){var r=e('../callbacks'),a=e('../utils'),i=e('../stash'),l=e('../mods'),o={}.hasOwnProperty;n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var n=e.credential[e.channel],t=['appId','timeStamp','nonceStr','package','signType','paySign'],a=0;a<t.length;a++)if(!o.call(n,t[a]))return void r.innerCallback('fail',r.error('invalid_credential','missing_field_'+t[a]));i.jsApiParameters=n,this.callpay()},callpay:function(){var e=this,n=l.getExtraModule('wx_jssdk');if(void 0!==n&&n.jssdkEnabled())n.callpay();else if('undefined'==typeof WeixinJSBridge){var t=function(){e.jsApiCall()};document.addEventListener?document.addEventListener('WeixinJSBridgeReady',t,!1):document.attachEvent&&(document.attachEvent('WeixinJSBridgeReady',t),document.attachEvent('onWeixinJSBridgeReady',t))}else this.jsApiCall()},jsApiCall:function(){o.call(i,'jsApiParameters')&&WeixinJSBridge.invoke('getBrandWCPayRequest',i.jsApiParameters,function(e){delete i.jsApiParameters,'get_brand_wcpay_request:ok'==e.err_msg?r.innerCallback('success'):'get_brand_wcpay_request:cancel'==e.err_msg?r.innerCallback('cancel'):r.innerCallback('fail',r.error('wx_result_fail',e.err_msg))})},runTestMode:function(e){if(confirm('模拟付款？')){var n='/charges/'+e.id;a.request(this.PINGPP_NOTIFY_URL_BASE+n+'?livemode=false','GET',null,function(e,n){if(n>=200&&n<400&&'success'==e)r.innerCallback('success');else{var t='http_code:'+n+';response:'+e;r.innerCallback('fail',r.error('testmode_notify_fail',t))}},function(){r.innerCallback('fail',r.error('network_err'))})}}}},{"../callbacks":1,"../mods":8,"../stash":10,"../utils":12}],4:[function(e,n,t){var r=e('./utils'),a=e('./stash'),i=e('./libs/md5'),l={seperator:'###',limit:1,report_url:'https://statistics.pingxx.com/one_stats',timeout:100},o=function(e,n){var t=new RegExp('(^|&)'+n+'=([^&]*)(&|$)','i'),r=e.substr(0).match(t);return null!==r?unescape(r[2]):null};l.store=function(e){if('undefined'!=typeof localStorage&&null!==localStorage){var n={};n.app_id=e.app_id||a.app_id||'app_not_defined',n.ch_id=e.ch_id||'',n.channel=e.channel||'',n.type=e.type||'',n.user_agent=navigator.userAgent,n.host=window.location.host,n.time=(new Date).getTime(),n.puid=a.puid;var t='app_id='+n.app_id+'&channel='+n.channel+'&ch_id='+n.ch_id+'&host='+n.host+'&time='+n.time+'&type='+n.type+'&user_agent='+n.user_agent+'&puid='+n.puid,r=t;null!==localStorage.getItem('PPP_ONE_STATS')&&0!==localStorage.getItem('PPP_ONE_STATS').length&&(r=localStorage.getItem('PPP_ONE_STATS')+this.seperator+t);try{localStorage.setItem('PPP_ONE_STATS',r)}catch(e){}}},l.send=function(){if('undefined'!=typeof localStorage&&null!==localStorage){var e=localStorage.getItem('PPP_ONE_STATS');if(!(null===e||e.split(this.seperator).length<this.limit))try{for(var n=[],t=e.split(this.seperator),a=i(t.join('&')),l=0;l<t.length;l++)n.push({app_id:o(t[l],'app_id'),channel:o(t[l],'channel'),ch_id:o(t[l],'ch_id'),host:o(t[l],'host'),time:o(t[l],'time'),type:o(t[l],'type'),user_agent:o(t[l],'user_agent'),puid:o(t[l],'puid')});r.request(this.report_url,'POST',n,function(e,n){200==n&&localStorage.removeItem('PPP_ONE_STATS')},void 0,{'X-Pingpp-Report-Token':a})}catch(e){}}},l.report=function(e){var n=this;n.store(e),setTimeout(function(){n.send()},n.timeout)},n.exports=l},{"./libs/md5":6,"./stash":10,"./utils":12}],5:[function(e,n,t){var r=e('./stash'),a=e('./utils'),i=e('./collection');n.exports={SRC_URL:'https://cookie.pingxx.com',init:function(){var e=this;a.documentReady(function(){try{e.initPuid()}catch(e){}})},initPuid:function(){if('undefined'!=typeof window&&'undefined'!=typeof localStorage&&null!==localStorage){var e=localStorage.getItem('pingpp_uid');if(null===e){e=a.randomString();try{localStorage.setItem('pingpp_uid',e)}catch(e){}}if(r.puid=e,!document.getElementById('p_analyse_iframe')){var n;try{n=document.createElement('iframe')}catch(e){n=document.createElement('<iframe name="ifr"></iframe>')}n.id='p_analyse_iframe',n.src=this.SRC_URL+'/?puid='+e,n.style.display='none',document.body.appendChild(n)}setTimeout(function(){i.send()},0)}}}},{"./collection":4,"./stash":10,"./utils":12}],6:[function(e,n,t){!function(){function e(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function t(n,t,r,a,i,l){return e((o=e(e(t,n),e(a,l)))<<(c=i)|o>>>32-c,r);var o,c}function r(e,n,r,a,i,l,o){return t(n&r|~n&a,e,n,i,l,o)}function a(e,n,r,a,i,l,o){return t(n&a|r&~a,e,n,i,l,o)}function i(e,n,r,a,i,l,o){return t(n^r^a,e,n,i,l,o)}function l(e,n,r,a,i,l,o){return t(r^(n|~a),e,n,i,l,o)}function o(n,t){var o,c,s,u,d;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;var f=1732584193,p=-271733879,h=-1732584194,m=271733878;for(o=0;o<n.length;o+=16)c=f,s=p,u=h,d=m,p=l(p=l(p=l(p=l(p=i(p=i(p=i(p=i(p=a(p=a(p=a(p=a(p=r(p=r(p=r(p=r(p,h=r(h,m=r(m,f=r(f,p,h,m,n[o],7,-680876936),p,h,n[o+1],12,-389564586),f,p,n[o+2],17,606105819),m,f,n[o+3],22,-1044525330),h=r(h,m=r(m,f=r(f,p,h,m,n[o+4],7,-176418897),p,h,n[o+5],12,1200080426),f,p,n[o+6],17,-1473231341),m,f,n[o+7],22,-45705983),h=r(h,m=r(m,f=r(f,p,h,m,n[o+8],7,1770035416),p,h,n[o+9],12,-1958414417),f,p,n[o+10],17,-42063),m,f,n[o+11],22,-1990404162),h=r(h,m=r(m,f=r(f,p,h,m,n[o+12],7,1804603682),p,h,n[o+13],12,-40341101),f,p,n[o+14],17,-1502002290),m,f,n[o+15],22,1236535329),h=a(h,m=a(m,f=a(f,p,h,m,n[o+1],5,-165796510),p,h,n[o+6],9,-1069501632),f,p,n[o+11],14,643717713),m,f,n[o],20,-373897302),h=a(h,m=a(m,f=a(f,p,h,m,n[o+5],5,-701558691),p,h,n[o+10],9,38016083),f,p,n[o+15],14,-660478335),m,f,n[o+4],20,-405537848),h=a(h,m=a(m,f=a(f,p,h,m,n[o+9],5,568446438),p,h,n[o+14],9,-1019803690),f,p,n[o+3],14,-187363961),m,f,n[o+8],20,1163531501),h=a(h,m=a(m,f=a(f,p,h,m,n[o+13],5,-1444681467),p,h,n[o+2],9,-51403784),f,p,n[o+7],14,1735328473),m,f,n[o+12],20,-1926607734),h=i(h,m=i(m,f=i(f,p,h,m,n[o+5],4,-378558),p,h,n[o+8],11,-2022574463),f,p,n[o+11],16,1839030562),m,f,n[o+14],23,-35309556),h=i(h,m=i(m,f=i(f,p,h,m,n[o+1],4,-1530992060),p,h,n[o+4],11,1272893353),f,p,n[o+7],16,-155497632),m,f,n[o+10],23,-1094730640),h=i(h,m=i(m,f=i(f,p,h,m,n[o+13],4,681279174),p,h,n[o],11,-358537222),f,p,n[o+3],16,-722521979),m,f,n[o+6],23,76029189),h=i(h,m=i(m,f=i(f,p,h,m,n[o+9],4,-640364487),p,h,n[o+12],11,-421815835),f,p,n[o+15],16,530742520),m,f,n[o+2],23,-995338651),h=l(h,m=l(m,f=l(f,p,h,m,n[o],6,-198630844),p,h,n[o+7],10,1126891415),f,p,n[o+14],15,-1416354905),m,f,n[o+5],21,-57434055),h=l(h,m=l(m,f=l(f,p,h,m,n[o+12],6,1700485571),p,h,n[o+3],10,-1894986606),f,p,n[o+10],15,-1051523),m,f,n[o+1],21,-2054922799),h=l(h,m=l(m,f=l(f,p,h,m,n[o+8],6,1873313359),p,h,n[o+15],10,-30611744),f,p,n[o+6],15,-1560198380),m,f,n[o+13],21,1309151649),h=l(h,m=l(m,f=l(f,p,h,m,n[o+4],6,-145523070),p,h,n[o+11],10,-1120210379),f,p,n[o+2],15,718787259),m,f,n[o+9],21,-343485551),f=e(f,c),p=e(p,s),h=e(h,u),m=e(m,d);return[f,p,h,m]}function c(e){var n,t='';for(n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function s(e){var n,t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function u(e){var n,t,r='0123456789abcdef',a='';for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),a+=r.charAt(n>>>4&15)+r.charAt(15&n);return a}function d(e){return unescape(encodeURIComponent(e))}function f(e){return c(o(s(n=d(e)),8*n.length));var n}function p(e,n){return function(e,n){var t,r,a=s(e),i=[],l=[];for(i[15]=l[15]=void 0,a.length>16&&(a=o(a,8*e.length)),t=0;t<16;t+=1)i[t]=909522486^a[t],l[t]=1549556828^a[t];return r=o(i.concat(s(n)),512+8*n.length),c(o(l.concat(r),640))}(d(e),d(n))}n.exports=function(e,n,t){return n?t?p(n,e):u(p(n,e)):t?f(e):u(f(e))}}()},{}],7:[function(e,n,t){var r=e('./version').v,a=e('./testmode'),i=e('./callbacks'),l=e('./mods'),o=e('./stash'),c=e('./collection'),s=e('./payment_elements'),u={}.hasOwnProperty,PingppSDK=function(){e('./init').init()};PingppSDK.prototype={version:r,createPayment:function(e,n,t,r){if('function'==typeof n&&(i.userCallback=n),s.init(e),u.call(s,'id'))if(u.call(s,'channel')){u.call(s,'app')&&('string'==typeof s.app?o.app_id=s.app:'object'==typeof s.app&&'string'==typeof s.app.id&&(o.app_id=s.app.id)),c.report({type:'pure_sdk_click',channel:s.channel,ch_id:s.id});var d=s.channel;if(u.call(s,'credential'))if(s.credential)if(u.call(s.credential,d))if(u.call(s,'livemode')){var f=l.getChannelModule(d);if(void 0===f)return console.error('channel module "'+d+'" is undefined'),void i.innerCallback('fail',i.error('invalid_channel','channel module "'+d+'" is undefined'));!1!==s.livemode?(void 0!==t&&(o.signature=t),'boolean'==typeof r&&(o.debug=r),f.handleCharge(s)):u.call(f,'runTestMode')?f.runTestMode(s):a.runTestMode(s)}else i.innerCallback('fail',i.error('invalid_charge','no_livemode_field'));else i.innerCallback('fail',i.error('invalid_credential','credential_is_incorrect'));else i.innerCallback('fail',i.error('invalid_credential','credential_is_undefined'));else i.innerCallback('fail',i.error('invalid_charge','no_credential'))}else i.innerCallback('fail',i.error('invalid_charge','no_channel'));else i.innerCallback('fail',i.error('invalid_charge','no_charge_id'))},setAPURL:function(e){o.APURL=e},setUrlReturnCallback:function(e,n){if('function'!=typeof e)throw'callback need to be a function';if(i.urlReturnCallback=e,void 0!==n){if(!Array.isArray(n))throw'channels need to be an array';i.urlReturnChannels=n}}},n.exports=new PingppSDK},{"./callbacks":1,"./collection":4,"./init":5,"./mods":8,"./payment_elements":9,"./stash":10,"./testmode":11,"./version":13}],8:[function(e,n,t){var r={}.hasOwnProperty,a={};n.exports=a,a.channels={wx_pub:e('./channels/wx_pub'),wx_lite:e('./channels/wx_lite')},a.extras={},a.getChannelModule=function(e){if(r.call(a.channels,e))return a.channels[e]},a.getExtraModule=function(e){if(r.call(a.extras,e))return a.extras[e]}},{"./channels/wx_lite":2,"./channels/wx_pub":3}],9:[function(e,n,t){var r=e('./callbacks'),a={}.hasOwnProperty;n.exports={id:null,or_id:null,channel:null,app:null,credential:{},extra:null,livemode:null,order_no:null,time_expire:null,init:function(e){var n;if('string'==typeof e)try{n=JSON.parse(e)}catch(e){return void r.innerCallback('fail',r.error('json_decode_fail',e))}else n=e;if(void 0!==n){if(a.call(n,'object')&&'order'==n.object){n.or_id=n.id,n.order_no=n.merchant_order_no;var t=n.charge_essentials;if(n.channel=t.channel,n.credential=t.credential,n.extra=t.extra,a.call(n,'charge')&&null!=n.charge)n.id=n.charge;else if(a.call(t,'id')&&null!=t.id)n.id=t.id;else if(a.call(n,'charges'))for(var i=0;i<n.charges.data.length;i++)if(n.charges.data[i].channel===t.channel){n.id=n.charges.data[i].id;break}}else a.call(n,'object')&&'recharge'==n.object&&(n=n.charge);for(var l in this)a.call(n,l)&&(this[l]=n[l]);return this}r.innerCallback('fail',r.error('json_decode_fail'))},clear:function(){for(var e in this)'function'!=typeof this[e]&&(this[e]=null)}}},{"./callbacks":1}],10:[function(e,n,t){n.exports={}},{}],11:[function(e,n,t){var r=e('./utils'),a={}.hasOwnProperty;n.exports={PINGPP_MOCK_URL:'http://sissi.pingxx.com/mock.php',runTestMode:function(e){var n={ch_id:e.id,scheme:'http',channel:e.channel};a.call(e,'order_no')?n.order_no=e.order_no:a.call(e,'orderNo')&&(n.order_no=e.orderNo),a.call(e,'time_expire')?n.time_expire=e.time_expire:a.call(e,'timeExpire')&&(n.time_expire=e.timeExpire),a.call(e,'extra')&&(n.extra=encodeURIComponent(JSON.stringify(e.extra))),r.redirectTo(this.PINGPP_MOCK_URL+'?'+r.stringifyData(n),e.channel)}}},{"./utils":12}],12:[function(e,n,t){var r=e('./callbacks'),a={}.hasOwnProperty,i=n.exports={stringifyData:function(e,n,t){void 0===t&&(t=!1);var r=[];for(var i in e)a.call(e,i)&&'function'!=typeof e[i]&&('bfb_wap'==n&&'url'==i||'yeepay_wap'==n&&'mode'==i||'channel_url'!=i&&r.push(i+'='+(t?encodeURIComponent(e[i]):e[i])));return r.join('&')},request:function(e,n,t,r,l,o){if('undefined'!=typeof XMLHttpRequest){var c=new XMLHttpRequest;if(void 0!==c.timeout&&(c.timeout=6e3),'GET'===(n=n.toUpperCase())&&'object'==typeof t&&t&&(e+='?'+i.stringifyData(t,'',!0)),c.open(n,e,!0),void 0!==o)for(var s in o)a.call(o,s)&&c.setRequestHeader(s,o[s]);'POST'===n?(c.setRequestHeader('Content-type','application/json; charset=utf-8'),c.send(JSON.stringify(t))):c.send(),void 0===r&&(r=function(){}),void 0===l&&(l=function(){}),c.onreadystatechange=function(){4==c.readyState&&r(c.responseText,c.status,c)},c.onerror=function(e){l(c,0,e)}}else console.log('Function XMLHttpRequest is undefined.')},formSubmit:function(e,n,t){if('undefined'!=typeof window){var r=document.createElement('form');r.setAttribute('method',n),r.setAttribute('action',e);for(var i in t)if(a.call(t,i)){var l=document.createElement('input');l.setAttribute('type','hidden'),l.setAttribute('name',i),l.setAttribute('value',t[i]),r.appendChild(l)}document.body.appendChild(r),r.submit()}else console.log('Not a browser, form submit url: '+e)},randomString:function(e){void 0===e&&(e=32);for(var n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',t=n.length,r='',a=0;a<e;a++)r+=n.charAt(Math.floor(Math.random()*t));return r},redirectTo:function(e,n){r.shouldReturnUrlByCallback(n)?r.triggerUrlReturnCallback(null,e):'undefined'!=typeof window?window.location.href=e:console.log('Not a browser, redirect url: '+e)},inWeixin:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('micromessenger')},inAlipay:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('alipayclient')},documentReady:function(e){'undefined'!=typeof document?'loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e):e()},loadUrlJs:function(e,n,t){var r=document.getElementsByTagName('head')[0],a=null;null==document.getElementById(e)?((a=document.createElement('script')).setAttribute('type','text/javascript'),a.setAttribute('src',n),a.setAttribute('id',e),a.async=!0,null!=t&&(a.onload=a.onreadystatechange=function(){if(a.ready)return!1;a.readyState&&'loaded'!=a.readyState&&'complete'!=a.readyState||(a.ready=!0,t())}),r.appendChild(a)):null!=t&&t()}}},{"./callbacks":1}],13:[function(e,n,t){n.exports={v:'2.1.16'}},{}]},{},[7])(7)});
//# sourceMappingURL=pingpp.js.map
